name: CI/CD Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}
  NODE_ENV: development
  PROJECT_ID: 905
  EMAILS: "mokshitjain18@gmail.com"
  TEST_IMAGE: mokshitjain18/drcode-regression-test-runner:v1

jobs:
  deploy-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Start drcode regression test runner
        run: |
          docker run -d \
            -e NODE_ENV=${{ env.NODE_ENV }} \
            -e PROJECT_ID=${{ env.PROJECT_ID }} \
            -e EMAILS=${{ env.EMAILS }} \
            --name drcode-regression-test-runner \
            ${{ env.TEST_IMAGE }}
